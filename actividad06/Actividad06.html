<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Expresiones Algebraicas</title>
    <style>
    /* ==================== VARIABLES Y RESET ==================== */
    :root {
        --color-primary: #2c5aa0;
        --color-secondary: #3b82f6;
        --color-accent: #f59e0b;
        --color-success: #10b981;
        --color-danger: #ef4444;
        --color-light: #f8fafc;
        --color-dark: #1e293b;
        --color-text: #333;
        --color-border: #e2e8f0;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
        --radius: 12px;
        --transition: all 0.3s ease;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7fa;
        color: var(--color-text);
        line-height: 1.6;
        min-height: 100vh;
    }

    /* ==================== ENCABEZADO ==================== */
    .header {
        background: linear-gradient(135deg, var(--color-primary) 0%, #1e3a8a 100%);
        color: white;
        padding: 2rem;
        border-radius: 0 0 var(--radius) var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
    }

    .logo-container {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        gap: 1rem;
    }

    .logo-icon {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: bold;
    }

    .logo-text {
        font-size: 1.5rem;
        font-weight: 300;
        line-height: 1.2;
    }

    .header h1 {
        font-size: 2.2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        font-style: italic;
    }

    /* ==================== CONTENEDOR PRINCIPAL ==================== */
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1.5rem 2rem;
    }

    /* ==================== SECCI√ìN DE CONVERSI√ìN ==================== */
    .converter-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    @media (max-width: 768px) {
        .converter-section {
            grid-template-columns: 1fr;
        }
    }

    .converter-card {
        background: white;
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow);
        border-top: 4px solid var(--color-secondary);
        transition: var(--transition);
    }

    .converter-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-hover);
    }

    .converter-card h2 {
        color: var(--color-primary);
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--color-border);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .converter-card h2:before {
        content: "‚ñ∂";
        font-size: 1rem;
        color: var(--color-accent);
    }

    /* ==================== FORMULARIOS Y ENTRADAS ==================== */
    .input-group {
        margin-bottom: 1.5rem;
    }

    .input-group label {
        display: block;
        color: var(--color-dark);
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    textarea {
        width: 100%;
        padding: 1rem;
        border: 2px solid var(--color-border);
        border-radius: 8px;
        font-size: 1rem;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        resize: vertical;
        min-height: 120px;
        transition: var(--transition);
        background: var(--color-light);
    }

    textarea:focus {
        outline: none;
        border-color: var(--color-secondary);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        background: white;
    }

    textarea::placeholder {
        color: #94a3b8;
        font-style: italic;
    }

    /* ==================== BOTONES ==================== */
    .btn {
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--color-secondary) 0%, #2563eb 100%);
        color: white;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(37, 99, 235, 0.3);
    }

    .btn:active {
        transform: translateY(0);
    }

    /* ==================== RESULTADOS ==================== */
    .result-section {
        margin-top: 1.5rem;
        padding: 1.5rem;
        background: var(--color-light);
        border-radius: 8px;
        border: 2px solid var(--color-border);
        display: none;
        animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .result-content h4 {
        color: var(--color-primary);
        margin-bottom: 1rem;
        font-size: 1.1rem;
    }

    .result-output {
        background: white;
        border: 1px solid var(--color-border);
        border-radius: 6px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        font-family: 'Courier New', monospace;
        font-size: 1.1rem;
        min-height: 60px;
        display: flex;
        align-items: center;
        word-break: break-word;
    }

    /* ==================== BOTONES DE EVALUACI√ìN ==================== */
    .evaluation-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.8rem;
        margin-top: 1rem;
    }

    .evaluation-btn {
        padding: 0.7rem 1rem;
        border-radius: 6px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        text-align: center;
        font-size: 0.9rem;
    }

    .evaluation-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-success {
        background: linear-gradient(135deg, var(--color-success) 0%, #059669 100%);
        color: white;
    }

    .btn-warning {
        background: linear-gradient(135deg, var(--color-accent) 0%, #d97706 100%);
        color: white;
    }

    .btn-info {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
    }

    /* ==================== SECCI√ìN DE DATOS ==================== */
    .data-section {
        background: white;
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
        border-top: 4px solid var(--color-success);
    }

    .data-section h2 {
        color: var(--color-primary);
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        text-align: center;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-top: 1rem;
    }

    .info-card {
        background: var(--color-light);
        border-radius: 8px;
        padding: 1.5rem;
        text-align: center;
        border: 1px solid var(--color-border);
        transition: var(--transition);
    }

    .info-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow);
    }

    .info-card h3 {
        color: var(--color-dark);
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .metric-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--color-primary);
        margin-bottom: 0.25rem;
    }

    .metric-label {
        font-size: 0.85rem;
        color: #64748b;
    }

    /* ==================== SECCI√ìN DE HISTORIAL ==================== */
    .history-section {
        background: white;
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow);
        border-top: 4px solid var(--color-accent);
    }

    .history-section h2 {
        color: var(--color-primary);
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        text-align: center;
    }

    .history-controls {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .history-btn {
        padding: 0.6rem 1.2rem;
        border-radius: 6px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }

    .btn-danger {
        background: linear-gradient(135deg, var(--color-danger) 0%, #dc2626 100%);
        color: white;
    }

    .btn-export {
        background: linear-gradient(135deg, var(--color-accent) 0%, #d97706 100%);
        color: white;
    }

    .history-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .history-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid var(--color-border);
        border-radius: 8px;
        padding: 1rem;
    }

    .history-item {
        background: var(--color-light);
        border-radius: 6px;
        padding: 1rem;
        margin-bottom: 0.8rem;
        border-left: 4px solid var(--color-secondary);
    }

    .history-item:last-child {
        margin-bottom: 0;
    }

    .history-item .type {
        font-weight: 600;
        color: var(--color-primary);
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .history-item .content {
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        color: var(--color-dark);
    }

    .no-history {
        text-align: center;
        color: #94a3b8;
        font-style: italic;
        padding: 2rem;
    }

    /* ==================== CARGADOR DE PATRONES ==================== */
    .patterns-section {
        background: white;
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
        border-top: 4px solid #8b5cf6;
    }

    .patterns-section h2 {
        color: var(--color-primary);
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        text-align: center;
    }

    .patterns-loader {
        display: flex;
        align-items: center;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .file-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    #json-file-input {
        display: none;
    }

    .file-input-label {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        padding: 0.7rem 1.2rem;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
    }

    .file-input-label:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);
    }

    .file-name {
        color: var(--color-dark);
        font-size: 0.9rem;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .patterns-btn {
        padding: 0.7rem 1.2rem;
        border-radius: 6px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }

    .patterns-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-secondary {
        background: var(--color-light);
        color: var(--color-dark);
        border: 2px solid var(--color-border);
    }

    .btn-secondary:hover:not(:disabled) {
        background: var(--color-border);
    }

    /* ==================== FEEDBACK Y MENSAJES ==================== */
    .feedback {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
        display: none;
    }

    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    .feedback.success {
        background: linear-gradient(135deg, var(--color-success) 0%, #059669 100%);
    }

    .feedback.warning {
        background: linear-gradient(135deg, var(--color-accent) 0%, #d97706 100%);
    }

    .feedback.error {
        background: linear-gradient(135deg, var(--color-danger) 0%, #dc2626 100%);
    }

    /* ==================== PIE DE P√ÅGINA ==================== */
    .footer {
        background: linear-gradient(135deg, var(--color-primary) 0%, #1e3a8a 100%);
        color: white;
        text-align: center;
        padding: 2rem;
        margin-top: 3rem;
        border-radius: var(--radius) var(--radius) 0 0;
    }

    .footer p {
        margin-bottom: 0.5rem;
        opacity: 0.9;
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 768px) {
        .header h1 {
            font-size: 1.8rem;
        }
        
        .converter-section {
            padding: 0;
        }
        
        .evaluation-buttons {
            grid-template-columns: 1fr;
        }
        
        .info-grid {
            grid-template-columns: 1fr;
        }
        
        .history-controls {
            flex-direction: column;
        }
        
        .patterns-loader {
            flex-direction: column;
            align-items: stretch;
        }
    }

    @media (max-width: 480px) {
        .header {
            padding: 1.5rem;
        }
        
        .container {
            padding: 0 1rem 1rem;
        }
        
        .converter-card,
        .data-section,
        .patterns-section,
        .history-section {
            padding: 1.5rem;
        }
    }
    </style>
</head>
<body>
    <!-- ENCABEZADO -->
    <header class="header">
        <div class="logo-container">
            <div class="logo-icon">A</div>
            <div class="logo-text">Tecnol√≥gico<br>de Software</div>
        </div>
        <h1>Calculadora de Expresiones Algebraicas</h1>
        <p class="subtitle">Convierte entre lenguaje natural y expresiones matem√°ticas en tiempo real</p>
    </header>

    <!-- CONTENEDOR PRINCIPAL -->
    <main class="container">
        <!-- SECCI√ìN DE CONVERSI√ìN -->
        <section class="converter-section">
            <!-- Columna de Lenguaje Natural -->
            <div class="converter-card">
                <h2>Lenguaje Natural ‚Üí Algebraico</h2>
                <div class="input-group">
                    <label for="natural-input">Expresi√≥n en palabras:</label>
                    <textarea 
                        id="natural-input" 
                        placeholder="Ejemplo: La suma de x y y, El producto de a por b elevado al cuadrado, La ra√≠z cuadrada de la suma de los cuadrados de a y b"
                        rows="5"
                    ></textarea>
                </div>
                <button id="convert-to-algebraic-btn" class="btn btn-primary">
                    <span>‚û°</span> Convertir a Expresi√≥n Algebraica
                </button>
                <div id="natural-result" class="result-section">
                    <div class="result-content">
                        <h4>Resultado:</h4>
                        <div id="natural-output" class="result-output"></div>
                    </div>
                    <div class="evaluation-buttons">
                        <button id="natural-satisfactory-btn" class="evaluation-btn btn-success">
                            ‚úÖ Satisfactorio
                        </button>
                        <button id="natural-improve-btn" class="evaluation-btn btn-warning">
                            üîÑ Mejorar
                        </button>
                        <button id="natural-add-pattern-btn" class="evaluation-btn btn-info">
                            ‚ûï Agregar Patr√≥n
                        </button>
                    </div>
                </div>
            </div>

            <!-- Columna de Expresi√≥n Algebraica -->
            <div class="converter-card">
                <h2>Algebraico ‚Üí Lenguaje Natural</h2>
                <div class="input-group">
                    <label for="algebraic-input">Expresi√≥n matem√°tica:</label>
                    <textarea 
                        id="algebraic-input" 
                        placeholder="Ejemplo: (x + y)¬≤, ‚àö(a¬≤ + b¬≤), (a + b)(a - b)"
                        rows="5"
                    ></textarea>
                </div>
                <button id="convert-to-natural-btn" class="btn btn-primary">
                    <span>‚¨Ö</span> Convertir a Lenguaje Natural
                </button>
                <div id="algebraic-result" class="result-section">
                    <div class="result-content">
                        <h4>Resultado:</h4>
                        <div id="algebraic-output" class="result-output"></div>
                    </div>
                    <div class="evaluation-buttons">
                        <button id="algebraic-satisfactory-btn" class="evaluation-btn btn-success">
                            ‚úÖ Satisfactorio
                        </button>
                        <button id="algebraic-improve-btn" class="evaluation-btn btn-warning">
                            üîÑ Mejorar
                        </button>
                        <button id="algebraic-add-pattern-btn" class="evaluation-btn btn-info">
                            ‚ûï Agregar Patr√≥n
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECCI√ìN DE DATOS DEL SISTEMA -->
        <section class="data-section">
            <h2>Informaci√≥n del Sistema</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>Patrones Cargados</h3>
                    <div class="metric">
                        <span class="metric-number" id="total-patterns">5</span>
                        <span class="metric-label">expresiones</span>
                    </div>
                </div>
                <div class="info-card">
                    <h3>Conversiones</h3>
                    <div class="metric">
                        <span class="metric-number" id="conversions-count">0</span>
                        <span class="metric-label">realizadas</span>
                    </div>
                </div>
                <div class="info-card">
                    <h3>Satisfacci√≥n</h3>
                    <div class="metric">
                        <span class="metric-number" id="satisfaction-rate">0%</span>
                        <span class="metric-label">tasa de √©xito</span>
                    </div>
                </div>
                <div class="info-card">
                    <h3>Complejidad</h3>
                    <div class="metric">
                        <span class="metric-number" id="avg-complexity">3.2</span>
                        <span class="metric-label">promedio</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECCI√ìN DE CARGA DE PATRONES -->
        <section class="patterns-section">
            <h2>Base de Datos de Patrones</h2>
            <div class="patterns-loader">
                <div class="file-input-wrapper">
                    <input type="file" id="json-file-input" accept=".json">
                    <label for="json-file-input" class="file-input-label">
                        üìÅ Cargar archivo JSON
                    </label>
                    <span id="file-name" class="file-name">Ning√∫n archivo seleccionado</span>
                </div>
                <button id="load-json-btn" class="patterns-btn btn-primary" disabled>
                    üì§ Cargar Patrones
                </button>
                <button id="reset-json-btn" class="patterns-btn btn-secondary">
                    üîÑ Usar Patrones por Defecto
                </button>
            </div>
        </section>

        <!-- SECCI√ìN DE HISTORIAL -->
        <section class="history-section">
            <h2>Historial de Conversiones</h2>
            <div class="history-controls">
                <button id="clear-history-btn" class="history-btn btn-danger">
                    üóëÔ∏è Limpiar Historial
                </button>
                <button id="export-history-btn" class="history-btn btn-export">
                    üì• Exportar Historial
                </button>
            </div>
            <div id="conversion-history" class="history-list">
                <p class="no-history">No hay conversiones realizadas a√∫n</p>
            </div>
        </section>
    </main>

    <!-- FEEDBACK -->
    <div id="feedback" class="feedback"></div>

    <!-- PIE DE P√ÅGINA -->
    <footer class="footer">
        <p><strong>Tecnol√≥gico de Software</strong> ‚Ä¢ Fundamentos de √Ålgebra</p>
        <p>Primer Cuatrimestre 2025 ‚Ä¢ Calculadora de Expresiones Algebraicas</p>
    </footer>

    <script>
    // ============================================================================
    // VARIABLES Y CONSTANTES
    // ============================================================================
    let patternsData = null;
    let conversionHistory = [];
    let stats = {
        totalConversions: 0,
        satisfactoryConversions: 0,
        totalPatterns: 0,
        lastUpdate: null
    };

    // Patrones por defecto
    const defaultPatterns = {
        "patterns": [
            {
                "id": 1,
                "natural": "La suma de {var1} y {var2}",
                "algebraic": "{var1} + {var2}",
                "category": "operaciones_basicas"
            },
            {
                "id": 2,
                "natural": "La resta de {var1} y {var2}",
                "algebraic": "{var1} - {var2}",
                "category": "operaciones_basicas"
            },
            {
                "id": 3,
                "natural": "El producto de {var1} por {var2}",
                "algebraic": "{var1} √ó {var2}",
                "category": "operaciones_basicas"
            },
            {
                "id": 4,
                "natural": "El cociente de {var1} sobre {var2}",
                "algebraic": "{var1} √∑ {var2}",
                "category": "operaciones_basicas"
            },
            {
                "id": 5,
                "natural": "La suma de los cuadrados de {var1} y {var2}",
                "algebraic": "{var1}¬≤ + {var2}¬≤",
                "category": "combinadas"
            },
            {
                "id": 6,
                "natural": "La diferencia de los cuadrados de {var1} y {var2}",
                "algebraic": "{var1}¬≤ - {var2}¬≤",
                "category": "combinadas"
            },
            {
                "id": 7,
                "natural": "El cuadrado de la suma de {var1} y {var2}",
                "algebraic": "({var1} + {var2})¬≤",
                "category": "productos_notables"
            },
            {
                "id": 8,
                "natural": "El cuadrado de la diferencia de {var1} y {var2}",
                "algebraic": "({var1} - {var2})¬≤",
                "category": "productos_notables"
            },
            {
                "id": 9,
                "natural": "El producto de la suma por la diferencia de {var1} y {var2}",
                "algebraic": "({var1} + {var2})({var1} - {var2})",
                "category": "productos_notables"
            },
            {
                "id": 10,
                "natural": "La ra√≠z cuadrada de {var1}",
                "algebraic": "‚àö{var1}",
                "category": "radicales"
            }
        ]
    };

    // ============================================================================
    // INICIALIZACI√ìN
    // ============================================================================
    document.addEventListener('DOMContentLoaded', function() {
        // Cargar patrones por defecto
        loadPatterns(defaultPatterns);
        
        // Configurar event listeners
        setupEventListeners();
        
        // Actualizar m√©tricas iniciales
        updateMetrics();
    });

    function loadPatterns(data) {
        patternsData = data;
        stats.totalPatterns = data.patterns.length;
        stats.lastUpdate = new Date().toLocaleString();
        updateMetrics();
        showFeedback('Patrones cargados correctamente', 'success');
    }

    function setupEventListeners() {
        // Botones de conversi√≥n
        document.getElementById('convert-to-algebraic-btn').addEventListener('click', convertNaturalToAlgebraic);
        document.getElementById('convert-to-natural-btn').addEventListener('click', convertAlgebraicToNatural);
        
        // Botones de evaluaci√≥n - Columna Natural
        document.getElementById('natural-satisfactory-btn').addEventListener('click', () => markAsSatisfactory('natural'));
        document.getElementById('natural-improve-btn').addEventListener('click', () => markForImprovement('natural'));
        document.getElementById('natural-add-pattern-btn').addEventListener('click', () => showAddPatternDialog('natural'));
        
        // Botones de evaluaci√≥n - Columna Algebraica
        document.getElementById('algebraic-satisfactory-btn').addEventListener('click', () => markAsSatisfactory('algebraic'));
        document.getElementById('algebraic-improve-btn').addEventListener('click', () => markForImprovement('algebraic'));
        document.getElementById('algebraic-add-pattern-btn').addEventListener('click', () => showAddPatternDialog('algebraic'));
        
        // Manejo de archivos JSON
        document.getElementById('json-file-input').addEventListener('change', handleFileSelection);
        document.getElementById('load-json-btn').addEventListener('click', loadJSONFile);
        document.getElementById('reset-json-btn').addEventListener('click', resetToDefault);
        
        // Historial
        document.getElementById('clear-history-btn').addEventListener('click', clearHistory);
        document.getElementById('export-history-btn').addEventListener('click', exportHistory);
        
        // Permitir Enter en textareas
        document.getElementById('natural-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                convertNaturalToAlgebraic();
            }
        });
        
        document.getElementById('algebraic-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                convertAlgebraicToNatural();
            }
        });
    }

    // ============================================================================
    // FUNCIONES DE CONVERSI√ìN
    // ============================================================================
    function convertNaturalToAlgebraic() {
        const input = document.getElementById('natural-input').value.trim();
        if (!input) {
            showFeedback('Por favor, ingresa una expresi√≥n en lenguaje natural', 'warning');
            return;
        }
        
        const result = processNaturalToAlgebraic(input);
        displayResult('natural', input, result);
        
        // Actualizar estad√≠sticas
        stats.totalConversions++;
        addToHistory('natural-to-algebraic', input, result);
        updateMetrics();
    }

    function convertAlgebraicToNatural() {
        const input = document.getElementById('algebraic-input').value.trim();
        if (!input) {
            showFeedback('Por favor, ingresa una expresi√≥n algebraica', 'warning');
            return;
        }
        
        const result = processAlgebraicToNatural(input);
        displayResult('algebraic', input, result);
        
        // Actualizar estad√≠sticas
        stats.totalConversions++;
        addToHistory('algebraic-to-natural', input, result);
        updateMetrics();
    }

    function processNaturalToAlgebraic(input) {
        if (!patternsData || !patternsData.patterns) {
            return "Error: No hay patrones cargados";
        }
        
        const normalizedInput = input.toLowerCase();
        
        // Buscar patrones que coincidan
        for (let pattern of patternsData.patterns) {
            const match = matchNaturalPattern(normalizedInput, pattern.natural);
            if (match.isMatch) {
                return substituteVariables(pattern.algebraic, match.variables);
            }
        }
        
        return "No se encontr√≥ un patr√≥n coincidente. Considera agregar este caso a los patrones.";
    }

    function processAlgebraicToNatural(input) {
        if (!patternsData || !patternsData.patterns) {
            return "Error: No hay patrones cargados";
        }
        
        const normalizedInput = normalizeAlgebraicExpression(input);
        
        // Buscar patrones que coincidan
        for (let pattern of patternsData.patterns) {
            const match = matchAlgebraicPattern(normalizedInput, pattern.algebraic);
            if (match.isMatch) {
                return substituteVariables(pattern.natural, match.variables);
            }
        }
        
        return "No se encontr√≥ un patr√≥n coincidente. Considera agregar este caso a los patrones.";
    }

    // ============================================================================
    // FUNCIONES DE PATRONES
    // ============================================================================
    function matchNaturalPattern(input, pattern) {
        let regex = pattern.toLowerCase();
        const variables = {};
        let varCounter = 0;
        
        // Reemplazar variables con grupos de captura
        regex = regex.replace(/\{(\w+)\}/g, (match, varName) => {
            variables[varName] = varCounter++;
            return '([a-zA-Z0-9_]+)';
        });
        
        // Hacer que los espacios sean flexibles
        regex = regex.replace(/\s+/g, '\\s*');
        regex = '^\\s*' + regex + '\\s*$';
        
        const regexPattern = new RegExp(regex);
        const match = input.match(regexPattern);
        
        if (match) {
            const extractedVars = {};
            for (let [varName, index] of Object.entries(variables)) {
                extractedVars[varName] = match[index + 1];
            }
            return { isMatch: true, variables: extractedVars };
        }
        
        return { isMatch: false, variables: {} };
    }

    function matchAlgebraicPattern(input, pattern) {
        let normalizedInput = normalizeAlgebraicExpression(input);
        let normalizedPattern = normalizeAlgebraicExpression(pattern);
        
        // Escapar caracteres especiales excepto llaves
        let regex = normalizedPattern.replace(/[+\-*^()\[\]]/g, '\\$&');
        
        const variables = {};
        let varCounter = 0;
        
        // Reemplazar variables con grupos de captura
        regex = regex.replace(/\{(\w+)\}/g, (match, varName) => {
            variables[varName] = varCounter++;
            return '([a-zA-Z0-9_]+)';
        });
        
        regex = '^\\s*' + regex + '\\s*$';
        
        const regexPattern = new RegExp(regex);
        const match = normalizedInput.match(regexPattern);
        
        if (match) {
            const extractedVars = {};
            for (let [varName, index] of Object.entries(variables)) {
                extractedVars[varName] = match[index + 1];
            }
            return { isMatch: true, variables: extractedVars };
        }
        
        return { isMatch: false, variables: {} };
    }

    function normalizeAlgebraicExpression(expr) {
        return expr
            .replace(/\s+/g, '') // Quitar espacios
            .replace(/¬≤/g, '^2') // Convertir ¬≤ a ^2
            .replace(/¬≥/g, '^3') // Convertir ¬≥ a ^3
            .replace(/\*/g, '√ó') // Normalizar multiplicaci√≥n
            .replace(/\//g, '√∑') // Normalizar divisi√≥n
            .toLowerCase();
    }

    function substituteVariables(template, variables) {
        let result = template;
        for (let [varName, value] of Object.entries(variables)) {
            const regex = new RegExp(`\\{${varName}\\}`, 'g');
            result = result.replace(regex, value);
        }
        return result;
    }

    // ============================================================================
    // FUNCIONES DE INTERFAZ
    // ============================================================================
    function displayResult(column, input, result) {
        const resultSection = document.getElementById(`${column}-result`);
        const outputElement = document.getElementById(`${column}-output`);
        
        outputElement.textContent = result;
        resultSection.style.display = 'block';
        
        // Scroll suave al resultado
        resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function markAsSatisfactory(column) {
        stats.satisfactoryConversions++;
        updateMetrics();
        
        showFeedback('Marcado como satisfactorio', 'success');
        
        // Ocultar resultado despu√©s de un tiempo
        setTimeout(() => {
            document.getElementById(`${column}-result`).style.display = 'none';
        }, 2000);
    }

    function markForImprovement(column) {
        showFeedback('Marcado para mejora. Considera agregar un nuevo patr√≥n.', 'warning');
    }

    function showAddPatternDialog(column) {
        const input = document.getElementById(`${column === 'natural' ? 'natural' : 'algebraic'}-input`).value;
        const output = document.getElementById(`${column}-output`).textContent;
        
        if (!input || !output) {
            showFeedback('Primero realiza una conversi√≥n v√°lida', 'warning');
            return;
        }
        
        const naturalText = column === 'natural' ? input : output;
        const algebraicText = column === 'natural' ? output : input;
        
        const newNatural = prompt('Expresi√≥n en lenguaje natural:', naturalText);
        if (!newNatural) return;
        
        const newAlgebraic = prompt('Expresi√≥n algebraica:', algebraicText);
        if (!newAlgebraic) return;
        
        const category = prompt('Categor√≠a (opcional):', 'personalizado') || 'personalizado';
        
        addNewPattern(newNatural, newAlgebraic, category);
    }

    function addNewPattern(natural, algebraic, category) {
        if (!patternsData) patternsData = { patterns: [] };
        
        const newId = patternsData.patterns.length + 1;
        const newPattern = {
            id: newId,
            natural: natural,
            algebraic: algebraic,
            category: category
        };
        
        patternsData.patterns.push(newPattern);
        stats.totalPatterns++;
        updateMetrics();
        
        showFeedback('Nuevo patr√≥n agregado correctamente', 'success');
    }

    // ============================================================================
    // MANEJO DE ARCHIVOS JSON
    // ============================================================================
    function handleFileSelection(event) {
        const file = event.target.files[0];
        const fileName = document.getElementById('file-name');
        const loadButton = document.getElementById('load-json-btn');
        
        if (file) {
            fileName.textContent = file.name;
            loadButton.disabled = false;
        } else {
            fileName.textContent = 'Ning√∫n archivo seleccionado';
            loadButton.disabled = true;
        }
    }

    function loadJSONFile() {
        const fileInput = document.getElementById('json-file-input');
        const file = fileInput.files[0];
        
        if (!file) {
            showFeedback('Por favor, selecciona un archivo JSON primero', 'warning');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (data.patterns && Array.isArray(data.patterns)) {
                    loadPatterns(data);
                    showFeedback('Archivo JSON cargado correctamente', 'success');
                } else {
                    showFeedback('Formato de archivo JSON inv√°lido', 'error');
                }
            } catch (error) {
                showFeedback('Error al leer el archivo JSON: ' + error.message, 'error');
            }
        };
        reader.readAsText(file);
    }

    function resetToDefault() {
        loadPatterns(defaultPatterns);
        showFeedback('Patrones restaurados a valores por defecto', 'success');
    }

    // ============================================================================
    // HISTORIAL
    // ============================================================================
    function addToHistory(type, input, result) {
        const historyItem = {
            id: conversionHistory.length + 1,
            type: type,
            input: input,
            result: result,
            timestamp: new Date().toLocaleString()
        };
        
        conversionHistory.push(historyItem);
        updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
        const historyList = document.getElementById('conversion-history');
        
        if (conversionHistory.length === 0) {
            historyList.innerHTML = '<p class="no-history">No hay conversiones realizadas a√∫n</p>';
            return;
        }
        
        let html = '';
        for (let i = Math.max(0, conversionHistory.length - 10); i < conversionHistory.length; i++) {
            const item = conversionHistory[i];
            const typeLabel = item.type === 'natural-to-algebraic' 
                ? 'Natural ‚Üí Algebraico' 
                : 'Algebraico ‚Üí Natural';
            
            html += `
                <div class="history-item">
                    <div class="type">${typeLabel} ‚Ä¢ ${item.timestamp}</div>
                    <div class="content"><strong>Entrada:</strong> ${item.input}</div>
                    <div class="content"><strong>Resultado:</strong> ${item.result}</div>
                </div>
            `;
        }
        
        historyList.innerHTML = html;
        
        // Scroll al final del historial
        historyList.scrollTop = historyList.scrollHeight;
    }

    function clearHistory() {
        if (conversionHistory.length === 0) {
            showFeedback('El historial ya est√° vac√≠o', 'warning');
            return;
        }
        
        if (confirm('¬øEst√°s seguro de que deseas limpiar todo el historial?')) {
            conversionHistory = [];
            updateHistoryDisplay();
            showFeedback('Historial limpiado correctamente', 'success');
        }
    }

    function exportHistory() {
        if (conversionHistory.length === 0) {
            showFeedback('No hay historial para exportar', 'warning');
            return;
        }
        
        const exportData = {
            metadata: {
                exportDate: new Date().toISOString(),
                totalItems: conversionHistory.length,
                project: "Calculadora de Expresiones Algebraicas"
            },
            history: conversionHistory
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = 'historial_conversiones_' + new Date().toISOString().slice(0,10) + '.json';
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        
        showFeedback('Historial exportado correctamente', 'success');
    }

    // ============================================================================
    // M√âTRICAS Y ESTAD√çSTICAS
    // ============================================================================
    function updateMetrics() {
        // Actualizar contadores
        document.getElementById('total-patterns').textContent = stats.totalPatterns;
        document.getElementById('conversions-count').textContent = stats.totalConversions;
        
        // Calcular tasa de satisfacci√≥n
        const satisfactionRate = stats.totalConversions > 0 
            ? Math.round((stats.satisfactoryConversions / stats.totalConversions) * 100)
            : 0;
        document.getElementById('satisfaction-rate').textContent = satisfactionRate + '%';
        
        // Actualizar complejidad promedio
        if (patternsData && patternsData.patterns.length > 0) {
            const totalWords = patternsData.patterns.reduce((sum, pattern) => {
                return sum + pattern.natural.split(' ').length;
            }, 0);
            const avgComplexity = (totalWords / patternsData.patterns.length).toFixed(1);
            document.getElementById('avg-complexity').textContent = avgComplexity;
        }
    }

    // ============================================================================
    // FEEDBACK Y UTILIDADES
    // ============================================================================
    function showFeedback(message, type) {
        const feedback = document.getElementById('feedback');
        feedback.textContent = message;
        feedback.className = `feedback ${type}`;
        feedback.style.display = 'block';
        
        setTimeout(() => {
            feedback.style.display = 'none';
        }, 3000);
    }

    // Funci√≥n para calcular el tama√±o del archivo
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    </script>
</body>
</html>