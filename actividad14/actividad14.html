<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora Simbólica Ecuaciones Lineales</title>

<style>
/* ============================
   ESTILO TIPO PORTAFOLIO
   ============================ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: "Segoe UI", Tahoma, sans-serif;
    background: #f2f4f7;
    color: #333;
    padding-bottom: 40px;
}

/* Header estilo portafolio */
header.top {
    background: #ffffff;
    padding: 35px 20px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

header.top h1 {
    font-size: 2.2rem;
    margin-bottom: 5px;
}

header.top p {
    font-size: 1.1rem;
    color: #666;
}

/* Contenedor principal */
.container {
    background: #ffffff;
    width: 95%;
    max-width: 900px;
    margin: 40px auto;
    padding: 35px;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.12);
}

/* Títulos */
h2 {
    margin-top: 20px;
    margin-bottom: 15px;
    font-size: 1.6rem;
    border-left: 5px solid #2a5298;
    padding-left: 10px;
    color: #1e3c72;
}

p {
    margin-bottom: 15px;
    font-size: 1rem;
    color: #555;
}

/* Inputs */
input[type="text"],
input[type="number"] {
    width: 100%;
    padding: 12px;
    margin: 10px 0 20px;
    font-size: 1.05rem;
    border: 1px solid #ccd3dd;
    border-radius: 8px;
    transition: 0.2s ease-in-out;
}

input:focus {
    border-color: #2a5298;
    outline: none;
    box-shadow: 0 0 4px #2a52989a;
}

/* Botones */
button {
    padding: 12px 25px;
    background: #2a5298;
    color: white;
    border: none;
    font-size: 1rem;
    border-radius: 8px;
    cursor: pointer;
    margin: 10px 10px 20px 0;
    transition: 0.2s ease;
}

button:hover {
    background: #1e3c72;
}

/* Caja de resultados */
.result-box {
    background: #f7faff;
    border: 1px solid #c6d4e8;
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
    font-size: 1.05rem;
}

.result-box pre {
    white-space: pre-wrap;
}

.formula-original {
    background: #eaf4ff;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 20px;
    font-weight: bold;
    border-left: 4px solid #2a5298;
}

.error-message {
    color: #d9534f;
    font-weight: bold;
    margin-top: 10px;
}

/* Tabla */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

th {
    background: #1e3c72;
    color: #fff;
    text-align: left;
    padding: 12px;
}

td {
    padding: 12px;
    border-bottom: 1px solid #d8dde6;
}

tbody tr:nth-child(even) {
    background: #f1f5fa;
}

tbody tr:hover {
    background: #e3ebf7;
}

/* Nota */
.nota-didactica {
    background: #fff3cd;
    padding: 15px;
    margin-top: 20px;
    border-left: 5px solid #c59f00;
    border-radius: 6px;
}

/* Footer */
footer {
    text-align: center;
    margin-top: 50px;
    color: #666;
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
</head>

<body>

<!-- =======================================================
     HEADER estilo idéntico al del Portafolio
=========================================================== -->
<header class="top">
    <h1>Calculadora Simbólica</h1>
    <p>Álgebra Lineal – Despeje y Ecuaciones</p>
</header>

<div class="container">

    <!-- ===============================
         PARTE 1
    ================================== -->
    <section>
        <h2>1. Solución de Ecuaciones de una Variable (x)</h2>
        <p>Introduce una ecuación lineal (ejemplo: <strong>2x + 3 = x + 8</strong>):</p>

        <input type="text" id="ecuacion" value="2x + 3 = x + 8">

        <button onclick="resolverEcuacionParseada()">Resolver</button>

        <div id="resDespejeParseado" class="result-box"></div>
        <div id="mensajeError" class="error-message"></div>
    </section>

    <hr style="margin: 40px 0; border: none; border-top: 1px solid #ddd;">

    <!-- ===============================
         PARTE 2
    ================================== -->
    <section>
        <h2>2. Despeje Simbólico de Fórmulas</h2>
        <p>Ejemplo: <strong>C = 5(F - 32)/9</strong></p>

        <label>Fórmula:</label>
        <input type="text" id="formulaLiteral" value="C = 5(F - 32)/9">

        <button onclick="procesarFormulaLiteral()">Generar Despejes</button>

        <div id="resFormulaLiteral" class="result-box"></div>
        <div id="mensajeErrorFormula" class="error-message"></div>
    </section>

</div>

<footer>
    Desarrollado para tu Portafolio — Álgebra Lineal
</footer>

<script>
/* ============================
   JAVASCRIPT ORIGINAL (sin cambios)
   ============================ */

function cleanString(str) { return str.replace(/\s+/g, ''); }

function resolverEcuacionParseada() {
    const ecuacionStr = document.getElementById('ecuacion').value;
    const resBox = document.getElementById('resDespejeParseado');
    const errorBox = document.getElementById('mensajeError');

    resBox.innerHTML = "";
    errorBox.innerText = "";

    try {
        const partes = ecuacionStr.split('=');
        if (partes.length !== 2) throw new Error("La ecuación debe tener un '='");

        const left = partes[0].trim();
        const right = partes[1].trim();

        const eq = `(${left}) - (${right})`;

        const nodo = math.parse(eq);
        const simplificado = math.simplify(nodo);

        const coef = extraerCoeficientes(simplificado.toString());
        const x = -coef.b / coef.a;

        resBox.innerHTML = `
            <div class="formula-original">Ecuación Original: ${ecuacionStr}</div>
            <p><strong>Solución:</strong> x = ${x}</p>
            <p><strong>Simplificada:</strong> ${simplificado.toString()} = 0</p>
        `;
    }
    catch (e) {
        errorBox.innerText = e.message;
    }
}

function extraerCoeficientes(eq) {
    eq = eq.replace(/\s+/g, '');
    let a = 0, b = 0;

    const rx = /([+-]?\d*\.?\d*)\*?x/g;
    let m;
    while ((m = rx.exec(eq)) !== null) {
        let c = m[1];
        if (c === '' || c === '+') c = '1';
        if (c === '-') c = '-1';
        a += parseFloat(c);
    }

    const sinX = eq.replace(/[+-]?\d*\.?\d*\*?x/g, '');
    try { b = math.evaluate(sinX); } catch { b = 0; }

    return { a, b };
}

function extractVariables(formula) {
    const m = formula.match(/[a-zA-Z][a-zA-Z0-9]*/g);
    return m ? Array.from(new Set(m)) : [];
}

/* ---- resto del JS (igual que el tuyo) ---- */
function despejarVariable(expr, varObj, varIzq) {
    try {
        expr = expr.replace(/\s+/g, '');
        const patron = /(\d*\.?\d*)\(([a-zA-Z]+)([+-])(\d+\.?\d*)\)\/(\d+\.?\d*)/;
        const match = expr.match(patron);

        if (match && match[2] === varObj) {
            const coef = match[1] || '1';
            const op = match[3];
            const cons = match[4];
            const div = match[5];
            const opInv = op === '-' ? '+' : '-';

            return coef === '1'
                ? `${varIzq} * ${div} ${opInv} ${cons}`
                : `${varIzq} * ${div} / ${coef} ${opInv} ${cons}`;
        }

        if (expr.includes('+') || expr.includes('-')) {
            const r = despejarSumaResta(expr, varObj, varIzq);
            if (r !== null) return r;
        }

        if (expr.includes('/')) {
            const partes = dividirPorOperadorPrincipal(expr, '/');
            const num = partes[0], den = partes[1];

            if (num.includes(varObj)) {
                if (num === varObj) return `${varIzq} * ${den}`;
                const f = extraerFactoresMultiplicacion(num).filter(x => x !== varObj);
                return f.length === 0
                    ? `${varIzq} * ${den}`
                    : `${varIzq} * ${den} / (${f.join('*')})`;
            }

            if (den.includes(varObj)) {
                if (den === varObj) return `${num} / ${varIzq}`;
                const f = extraerFactoresMultiplicacion(den).filter(x => x !== varObj);
                return f.length === 0
                    ? `${num} / ${varIzq}`
                    : `${num} / (${varIzq} * ${f.join('*')})`;
            }
        }

        if (expr.includes('*')) {
            const f = extraerFactoresMultiplicacion(expr).filter(x => x !== varObj);
            if (f.length === 0) return varIzq;
            if (f.length === 1) return `${varIzq} / ${f[0]}`;
            return `${varIzq} / (${f.join('*')})`;
        }

        return varIzq;
    }
    catch {
        return "Error";
    }
}

function despejarSumaResta(expr, varObj, varIzq) {
    const t = parsearTerminos(expr);
    let conVar = null, otros = [];

    for (const x of t) {
        if (x.texto.includes(varObj)) conVar = x;
        else otros.push(x);
    }

    if (!conVar) return null;

    let res = varIzq;

    for (const o of otros) {
        const inv = o.signo === '+' ? '-' : '+';
        res += ` ${inv} ${o.texto}`;
    }

    if (conVar.texto !== varObj && conVar.texto.includes('*')) {
        const pr = conVar.texto.split('*').find(p => p !== varObj);
        res = `(${res}) / ${pr}`;
    }

    if (conVar.signo === '-') res = `-(${res})`;

    return res;
}

function parsearTerminos(expr) {
    const arr = [];
    let txt = '', sign = '+', lvl = 0;

    for (let i = 0; i < expr.length; i++) {
        const c = expr[i];

        if (c === '(') { lvl++; txt += c; }
        else if (c === ')') { lvl--; txt += c; }
        else if ((c === '+' || c === '-') && lvl === 0) {
            if (txt !== '') arr.push({ signo: sign, texto: txt });
            sign = c;
            txt = '';
        } else txt += c;
    }

    if (txt) arr.push({ signo: sign, texto: txt });
    return arr;
}

function dividirPorOperadorPrincipal(expr, op) {
    let lvl = 0, pos = -1;

    for (let i = expr.length - 1; i >= 0; i--) {
        const c = expr[i];
        if (c === ')') lvl++;
        else if (c === '(') lvl--;
        else if (c === op && lvl === 0) { pos = i; break; }
    }

    if (pos === -1) return [expr];
    return [expr.substring(0, pos), expr.substring(pos + 1)];
}

function extraerFactoresMultiplicacion(expr) {
    const arr = [];
    let txt = '', lvl = 0;

    for (let i = 0; i < expr.length; i++) {
        const c = expr[i];
        if (c === '(') { lvl++; txt += c; }
        else if (c === ')') { lvl--; txt += c; }
        else if (c === '*' && lvl === 0) {
            arr.push(txt);
            txt = '';
        } else txt += c;
    }

    if (txt) arr.push(txt);
    return arr;
}

function procesarFormulaLiteral() {
    const f = document.getElementById("formulaLiteral").value;
    const box = document.getElementById("resFormulaLiteral");
    const err = document.getElementById("mensajeErrorFormula");

    box.innerHTML = "";
    err.innerText = "";

    try {
        const partes = f.split('=');
        if (partes.length !== 2) throw new Error("Debe contener '='");

        const left = partes[0].trim();
        const right = partes[1].trim();

        const vars = extractVariables(f);
        if (vars.length < 2) throw new Error("Se requieren al menos 2 variables");

        let html = `
        <div class="formula-original">Fórmula Original: ${f}</div>
        <p><strong>Variables:</strong> ${vars.join(", ")}</p>

        <table>
            <thead>
                <tr><th>Variable</th><th>Despeje</th></tr>
            </thead>
            <tbody>
        `;

        for (const v of vars) {
            let r = (left === v)
                ? `${v} = ${right}`
                : `${v} = ${despejarVariable(right, v, left)}`;

            html += `<tr><td>${v}</td><td><pre>${r}</pre></td></tr>`;
        }

        html += `</tbody></table>
        <div class="nota-didactica">
        Nota: Los despejes se generan mediante manipulación algebraica directa.
        </div>`;

        box.innerHTML = html;
    }
    catch (e) {
        err.innerText = e.message;
    }
}

document.addEventListener("DOMContentLoaded", resolverEcuacionParseada);
</script>

</body>
</html>
